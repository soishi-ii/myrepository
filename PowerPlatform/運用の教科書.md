# 第1章 ガバナンス運用設計の理念

## 1-1 AIを活用するために

- 生成AIを活用するにはすべてをローコード化してクラウド化することで準備ができるらしい・・・
- 経営層の79%は活用したいが、60%は明確なビジョンを持っていない
- 結果、個々が利用する傾向になりセキュリティやプライバシーのリスク増
- **市民開発**・・・ユーザーによる開発
- copiotstdio,apps,automate,pages,bi
- 全社導入にはセキュリティとガバナンスの設計が必要

## 1-2 PowerPlatformを運用するために

- 可視化ツールを利用してガバナンスと生産性を両立しよう
- トヨタや三井住友銀行は全社規模で導入してる
- ガバナンスと運用体制を整えて5000人以上の社員が開発してる事例あり
- 様々なサービスと接続できるので、気を付けないと問題が起きる
	- 情報流出
	- アプリ、フローの乱立
	- 容量、実行数制限の圧迫
- データ損失を防ぐ機能ある
- 管理と開発のしやすさはトレードオフ

# 第2章 PowerPlatformを全社利用するための運用体制

## 2-1 「ガバナンス」の意味
- governer(舵を取る)
- 管理や統制を徹底してリスクを軽減する ＋ どこに向かうのか目標への舵取り
- 制限してばかりでは開発が遅くなる
- 効果的にガバナンスを進めるには組織のゴールを明確化し、誰が責任を持つのか、どのような優先度でタスクを進めるのか、整理する

## 2-2 目標の明確化
### PowerPowerPlatform 導入成熟度モデル
- MS本社が成功・失敗事例をもとに作ったガイドライン
- 段階的に成熟度を高めましょう
- 次の各評価項目を5つのレベルで示す。
	- 戦略とビジョン
	- ビジネスバリュー
	- 育成と市民開発者
	- 自動化
	- フュージョンチーム
	- サポート
	- 管理とガバナンス
### 管理とガバナンス
- レベル100 - 初期段階
	- 使用状況把握なしガバナンスなしポリシーなし。
- レベル200 - 再現可能段階
	- IT部門と連携しながら制御するよう取り組む。管理者が使用状況を監視。戦略やポリシーなし。
- レベル300 - 定義済み段階
	- 戦略、監視、ポリシーを組織全体の標準として定義するよう取り組む。測定可能な成功を目指す。
- レベル400 - 利用可能段階
	- 管理と監視ための標準プロセスが定義されており、全ての開発者が標準化された機能を使える。知見を共有している。
- レベル500 - 効率化段階
	- ビジネスの変革やデジタル化に迅速に対応できる状態。AIなどの高度な機能の統合。
![[Pasted image 20250516221832.jpg]]

## 役割の明確化


| 役割                | 責任範囲                          |
| ----------------- | ----------------------------- |
| PowerPlatform管理者  | 組織でサポートするサービスの管理              |
| エグゼクティブスポンサー(経営層) | ビジネスニーズに基づき、プロジェクトの承認やリソース調達、 |
| Microsoft365 管理者  |                               |
| アーキテクチャチーム        |                               |
| サイバーセキュリティチーム     |                               |
| IT運用チーム           |                               |
| コミュニティ・利活用推進リード   |                               |
| データ・情報ガバナンス       |                               |
| 開発者               |                               |
| プロジェクトマネジメントオフィス  |                               |
| 各部の推進担当           |                               |
## タスクの明確化
	・・・なのか？武田薬品工業の成功事例だった
1. 専任チームを結成する
2. いきなり大規模に導入するのではなく小さく始める(5人とか)
	- 早く失敗を体験する
3. 組織に成功例を示す
4. 他人の活用を推進する
5. 組織の専門家とタッグを組む
6. 全社員が活用
-  「PowerPlatform 導入における現状評価」 無料だが英語のみ

# 第3章 環境とデータ損失防止ポリシー
## PowerPlatformの設定


| 単語        | 説明                                                 |
| --------- | -------------------------------------------------- |
| テナント      | 組織全体のセキュリティ設定                                      |
| 環境グループ    | 環境をグループ単位で設定可能な枠                                   |
| 環境        | 組織のビジネスデータ、アプリ、フロー、カスタムCopilot、Webサイトを保存・管理・共有する場所 |
| Dataverse | データプラットフォーム                                        |
| セキュリティロール | Dataverseで設定可能なセキュリティ設定                            |
## テナントとは
- MSクラウドの組織単位にユーザーやライセンス、アプリを管理する枠組み。
- 各テナントごとに独立した管理者、利用者、データ保存領域が与えられる。

## 3-3 環境について
- 組織のビジネスデータ、アプリ、フロー、エージェント、Webサイトを保存・管理・共有する場所
- 1つのテナントに複数のPowerPlatformの環境を作る。
- ロールやセキュリティの設定が可能。
- 環境ごとに管理者がいる。
- ユーザーにアクセス権を設定する必要がある。
- 支社ごと、部署ごと、開発環境ごとに環境を作ったりする。

### Dataverseと環境
- 環境ごとに1つのDataverseがある。
- 現在PowerPlatformで作成したものは 全部Dataverseに保存される。
- 環境は地理的な場所から選択できる。リージョン変更は不可。
- データセンターが冗長構成(東日本と西日本)
### 環境の種類

| 種類                      | 用途・特徴                                    | 使用例                                      |
| ----------------------- | ---------------------------------------- | ---------------------------------------- |
| **既定の環境（Default）**      | テナントに1つ自動生成され、全ユーザーが利用可能                 | - 学習、試作、PoC（簡易な検証）<br>- ガバナンスが難しいので本番非推奨 |
| **Production（本番環境）**    | 業務用途向けに設計された環境。フル機能と SLA 保証              | - 業務アプリの本番運用<br>- ユーザーへの共有や監査対象データを扱う    |
| **Sandbox（サンドボックス）**    | 本番に似た構成で、テスト・開発用に使う。リセットやコピー可能           | - テスト環境- 本番アプリの修正・動作確認                   |
| **Trial（試用）**           | 一時的な評価・検証用（30日間）                         | - デモやPoC<br>- 本番移行前の短期検証                 |
| **Developer（開発者用）**     | Microsoft 365 開発者プログラムで提供。Dataverseも使用可能 | - 個人開発や学習- ISV開発用                        |
| **Dataverse for Teams** | Teams チーム単位での業務アプリ構築や、業務データの簡易管理         | - チーム内のちょっとした業務効率化アプリ                    |
|                         |                                          |                                          |
### マイクロソフト社内の環境戦略
- 環境グループが３つある(環境グループについては後述)

| 環境                      | 作成タイミング    | 権限                           | コネクタ                           | 削除タイミング                            |
| ----------------------- | ---------- | ---------------------------- | ------------------------------ | ---------------------------------- |
| 開発者用                    | 自動作成       | 個人専用・共用不可<br>データ損失防止ポリシー設定あり | ほとんどのコネクタが使える<br>特定のアクションは利用不可 | 長期未使用時に自動削除                        |
| **Dataverse for Teams** | 自動作成       | グループラベルに紐づく                  | ほとんどのコネクタが使える<br>特定のアクションは利用不可 | 長期未使用時に自動削除                        |
| サンドボックス＆本番環境            | 作成時に承認プロセス | 追加のコンプライアンス・ポリシーレビュー         | すべてのコネクタが使える<br>用途に応じてカスタムで設定  | メールで飛んでくる誓約に同意すれば期間延長<br>そうでなければ削除 |
### 環境に対するセキュリティグループの設定
- 環境ごとにアクセス制御を行うためのもの。1つだけ設定できる。
- 環境作成時か、作成済み環境に対して設定する(当たり前では)
- 具体例では"人事部_ALL"という名前で設定していた。
- そのあとにアプリやDataverseでさらに細かいアクセス制御するのが定石らしい。

### マネージド環境で更にセキュアにする
- ガバナンスを重視する場合は**マネージド環境が推奨**される
#### マネージド環境とは
- より高度に監視、一元管理、ガバナンス制御をできるようにした環境。標準の「Production環境」や「Sandbox環境」などに対して、管理機能を拡張するための設定。
- 複数の環境に対して一括で設定を更新できる。(環境グループ)
- 個々の環境やアプリの状況を把握できる。
- **マネージド環境を利用するには、その環境下のユーザーすべてがAppsPremium、AutomatePremiumのいずれかのライセンスが付与されている必要がある。**
- 
#### 環境グループ(マネージド環境)
- 複数の環境をグルーピングし、一括管理できる機能。

#### 環境ルーティング(マネージド環境)
- 個々が作る環境を強制的にコントロールすること
- たとえば「既定の環境」が個々で量産されて手に負えなくなる、なんてことを防ぐ。
#### 環境の作成制御
- 管理者権限をもつユーザーのみ環境を作成できるようにする。
- 管理者は「グローバル管理者」「代行管理者」「D365管理者」「PowerPlatform管理者」のいずれかである必要がある。

## データ損失ポリシー(DLP)
- どのコネクタがどのアクションを利用できるか設定すること。
- テナントごと、環境ごとに設定できる。
- DLPの設定方法が書いてある

### DLPの種類
- 3つの種類のポリシーがある。
	- **業務**・・・よく使うもの
	- **ブロック**・・・使わせないもの。
	- **非ビジネス**・・・ブロック出来ないけど業務と共存させない(Facebookコネクタとか)
- 複数のポリシーを設定できるが、ブロックが最も優先度が高い。
- また全社ポリシー > 固有のポリシーのように組み合わせて使える。

| ポリシー適用範囲                   | 設定内容の例                                                                                                             |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| テナント(全社ポリシー)               | 組織で絶対使わないコネクタをブロックしとく                                                                                              |
| 既定環境                       | 既定環境は誰でも使えるので最も厳しくポリシーを設定する。<br>ほとんどの組織はM365だけ使えるようにしてるらしい                                                         |
| 開発・テスト・運用環境                | 個々のプロジェクトや全社向けサービスをここで設定する。<br>カスタムコネクタにはURLの許可リストを設定できる。                                                          |
| パワーユーザー向け                  | 既定環境とは別に用意して、より緩く設定する。<br>DataverseやAI Builderなど。<br>*環境ごとに設定するのかしないのか・・・正直よくわからない*                                |
| DLP既定グループ                  | 新規コネクタの設定。<br>**初期設定では「非ビジネス」になってるので通常は「ブロック」に設定するのが推奨。**                                                          |
| 個別環境ポリシー                   | 例外的なポリシーを設定したい環境に使う。<br>全社ポリシーで「特定の環境を除外する」を選択する。                                                                  |
| デスクトップフロー・RPAのDLP(マネージド環境) | ローカルで動作するフローに適用するためのもの。<br>取り扱われるデータは予測できないため、ここでDLPを設定するのは大事。<br>各アクションのカテゴリー単位で制御できる。(ActiveDirectory、クリップボードなど) |
|                            |                                                                                                                    |

# 第4章 テナントのセキュリティを向上させる

## Power Platformにおけるゼロトラストセキュリティ
- 「明示的な検証」、「最小特権アクセス」、「侵害を想定する」の3つの柱に基づく
	- 明示的な検証
		- 多要素認証
		- 条件付きアクセス
	- 最小特権アクセス
		- テナント分離
		- アプリ、フローの共有の管理(マネージド環境)
		- メール流出制御
	- 侵害を想定する
		- DLPポリシー(モニタリング)
		- IPファイアウォール(マネージド環境)
		- 監査ログやアクティビティの活用
		- 定期監査によるフィードバックサイクル
- 不正アクセスが発生しても、常に認証と認可の検証を必要とさせることで被害を最小限に抑える。
- 利便性やスピード感を損なわない
- ゼロトラストをベースとしてセキュリティ構成や設定内容を紹介する

## 4-2 テナント全体に対するセキュリティ
### テナント分離で他のテナントとの通信を防ぐ
- **既存設定ではAppsやAutomateでは他の組織のテナントに接続できてしまう。**　
- 他テナントへのアクセス、他テナントからのアクセスを防御する。
- 管理センター > セキュリティ > アクセス制御 > テナント分離
	- テナント間接続を制御する　を有効にするだけ
	- 反映まで1時間かかる

### 共有の管理で共有を制限(マネージド環境)
- アプリやフロー、エージェントの共有範囲を制御する。
- 特定のセキュリティグループに所属するユーザー間でのみ共有できる。
- PowerAppsではセキュリティグループではなく特定の個人のみ共有を許可できる。
- PowerAutomateではフローの共有を防止して自動化プロセスを勝手に変更できなくできる。
- CopilotStdioでは以下を制限する。
	- 作成者が共有するエージェントをどこまで他のユーザーが編集可能にするか
	- 利用者がどこまで閲覧可能か
### 顧客管理キー(マネージド環境)
- 通常はMS管理の暗号鍵でクラウドデータを暗号化しているが、CMKを導入すると組織自らのキーで暗号化できる。
- セキュリティやコンプライアンス要件が厳しい業種にも対応

### カスタマーロックボックス(マネージド環境)
- 自社のデータベースにアクセスするMSサポートチームに対して厳密に制御・承認を行うこと。
- 監査視点でも「誰が、いつ、なぜデータにアクセスしたのか」明確に記録できる。
### Power Platform経由のメール流出制御
- 機密性の高いデータを含むメール送信をブロックして管理者に通知する。
#### Exchangeのメールヘッダーの仕組み
- メールヘッダーに対するポリリーやルールを細かく設定できる。
	- 特定のヘッダー情報に該当するメールは削除
	- メール本文や件名に機密情報がある場合は警告
	- PowerAutomate生成のメールを識別
	- 例外ケース等も作れる
	- ブロックされた送信者にはエラーメールを飛ばす
## 4-3 個々の環境に対するセキュリティ
- 環境ごとにセキュリティ設定できる。
	- Dataverseでロールごとにセキュリティを設定してアクセス制御
		- 必要なテーブルのみアクセスできる
	- IPアドレスの接続制限(マネージド環境)
		- 社内ネットワークか特定のVPNからのみ接続を許可するなど
	- Azure VNETポリシーによるネットワーク経路の制御(マネージド環境)
		- 特定のサブネット(Azure Vnetなど)を経由する接続だけ許可するなど

### IPアドレス関連の各種設定
#### IPファイアウォール(マネージド環境)
前述したとおり
#### IPアドレスベースのCookieバインド(マネージド環境)
- セッションのIPアドレスとCookieを関連付けて管理
- ログインした直後と異なるIPアドレスは再認証させる(セッションハイジャックを防ぐ)
- 管理センターから　管理 ＞環境＞設定　IPアドレスに基づくバインドを有効します

#### Azure仮想ネットワークのポリシー(マネージド環境)
- PowerPlatformとAzure Vnetを統合しネットワークレベルで強化されたセキュリティを実現
- オンプレミスや仮想ネットワーク内部にあるデータソースも安全かつプライベートな経路でアクセスできる
- 組織の資産(DB,ファイルサーバー,REST API)をインターネットに直接公開せずに利用できる
	- ChatGPT曰く、完全に閉じたNWではないとのこと
	- Power PlatformはPaaS（クラウドサービス）のため、**Microsoftクラウド基盤への依存**は残る
	- ユーザーインターフェースはインターネット上にあるため、**完全な社内完結にはなりません**
	- リソースの通信だけが内部NWを通る？
- VNETを利用した様々なネットワークパターンについて例がある。
#### Azure仮想ネットワークのポリシー事例
- トヨタがクラウドベースのAIエージェントを活用して製造に関する膨大な知識ベースを社内の作業員同士で共有できるようにした取り組み
- 企業ポリシーを遵守したまま社内NWのFW内に蓄積されたデータを参照する必要があり、社内ゲートを複数設定する運用の手間を省くために、活用した(設定内容は書かれてない)

#### Azure仮想ネットワークポリシーの設定方法
- 長いので割愛

#### ゲストアクセスの無効化

- 外部から環境へアクセスしてくる組織外を招待する機能を無効化
- 管理センターから　セキュリティ＞IDおよびアクセス管理＞ゲストアクセス

## 4-4 Dataverseのデータセキュリティ
### そもそもDataverseとは
- Dataverseはクラウド上のリレーショナルデータベース
- ロールベースのセキュリティモデルにより業務内容や役職に応じてアクセス権を設定できる。
- Microsoft Entra IDはユーザーやグループを管理するので親和性がある。
- ビジネスロジックを一元的に管理・再利用できる仕組みがある(本書では書かれてない)
	- 入力データの自動検証
	- 機密情報を扱うテーブルへのアクセス制限
- 監査ログなどのログ管理機能が充実

### Dataverseのデータアクセス管理
- ふつうのRDBと同じような機能を持ってる
- 上記に加えてセキュリティロールと行単位のアクセス制御ができる
- 所有者、部署、チームの3つの要素で制御を行う。(これがロールか？)
#### 所有者について
- レコード単位でユーザーまたはチームを所持者として設定できる。
- ユーザー所有だと個人の権限によって共有範囲が変わる
- チーム所有のほうが権限管理しやすい

#### 部署について
- 階層構造で作れる。3階層がおすすめ(会社→部→課)
- それぞれでセキュリティロールの範囲を制御する
#### チームについて
- ユーザーをグルーピングする
- セキュリティロールと紐付けられる
- 「所有者チーム」と「アクセスチーム」がある

### **Dataverse チーム種別の比較表**

| 比較項目              | **所有者チーム（Owner Team）**          | **アクセス チーム（Access Team）**             |
| ----------------- | ------------------------------- | ------------------------------------- |
| **レコードの所有**       | 可能（チームがレコードの所有者になれる）            | 不可（レコードの所有者にはなれない）                    |
| **セキュリティ ロールの付与** | 可能（チームにロールを直接割り当てられる）           | 不可（ユーザー個人のロールに依存）                     |
| **アクセス権の制御方法**    | セキュリティロールによる権限制御                | レコード単位の「共有」による個別アクセス制御                |
| **メンバーシップの管理**    | 静的（ユーザーを手動で追加・削除）               | 動的（アプリ、プラグイン、Power Automateで追加・削除が可能） |
| **チームの種類**        | 所属ベース（例：部門、プロジェクト単位など）          | レコードベース（特定レコードに関わるメンバー）               |
| **推奨されるユースケース**   | チーム単位で恒久的にロール管理が必要な場合           | 一時的・柔軟なレコード共有が必要な場合                   |
| **レコードの可視性**      | チームが所有するレコードは、ロールの範囲に従ってアクセスされる | メンバーは共有された特定レコードにのみアクセス可能             |
| **自動化との親和性**      | 低（手動管理が基本）                      | 高（フロー・コードで自動追加・削除が容易）                 |
| **組織の管理コスト**      | 中〜高（人数が多いと管理が煩雑になる可能性）          | 低〜中（自動化できれば管理負荷が低い）                   |
| **利用できるシナリオ例**    | 顧客サポート部門のチームがすべての案件を管理する        | 営業担当者が担当する特定の商談だけ他のメンバーと共有する          |

EntraIDの説明は割愛

#### Dataverseのセキュリティロール
- テーブルに対して、どのユーザがどの程度​CRUDできるか定義する 
	- 「ユーザ」、「部署」、「部署配下」、「組織」のアクセスレベルがある。配下の属性に対してアクセスが可能となる。
- レコーごとの共有設定も行う
- ロールごとに監査ログを追跡できる
- apps automate エージェントもこの権限設定に従う
#### セキュリティロールの構成例
- ここでは経費精算アプリを例に紹介された
- 申請者、承認者、経理担当に対して経費精算テーブルのCRUDにどのアクセスレベルで権限を付与するか書かれている
#### セキュリティロールのベストプラクティス
- ゼロから自力で全部作ってはいけない
- 権限の低い標準のセキュリティロール「Basic User」を複製し、利用用途に応じて変更を加える。
#### セキュリティロールの作成と編集
- 管理センターから 管理＞環境＞設定＞ユーザーとアクセス許可＞セキュリティロール
- 詳細は割愛するが、以下の操作を行っている
	- 「Basic User」をコピーして「営業マネージャー」を作成し
	- 「取引先企業」テーブルの「読み取り」に対し、アクセスレベル「組織」を設定。

#### セキュリティロールのユーザーへの割当
- 1ユーザーに対して複数のセキュリティロールを割り当てられる。(権限は加算される)
- 設定方法は割愛
### システム管理者(System Administrator)権限について
- 全ての操作が可能
- グローバル管理者に自動設定されないので「自己昇格」で手動で設定する。
## 4-5 Microsoft Entra と組み合わせた強固なセキュリティ
### Mcrosoft Entra IDの条件付きアクセスとの組み合わせ
- 条件付きアクセスとはユーザーがアプリやサービスにアクセスするときに追加認証やアクセス制限を課すこと。不正アクセスを防ぐ。
	- 社内ネットワークに接続しているか
	- 多要素認証の利用有無
	- 端末が準拠済みか
- 厳格なポリシーを設定すると生産性が損なわれるので、利用パターンを分析しながら段階的に条件付きポリシーを導入するのがベストプラクティス。
#### 条件付きアクセスの設定方法
- 人事部門のユーザーを対象に、信頼できるIP以外からApps,Automateを利用した場合はブロックする例を紹介
- 詳細の設定方法は割愛
### Mcirosoft Entra PIM との組み合わせによる特殊管理
- PIMはPowerPlatformの管理に関わる特権を持つロールを管理し、最小限のリスクで運用できるようにする仕組み
- PIMを使うと特権を必要なときだけ一時的に付与できる。
- 特権ロールに対して「有効なロール」から「適格なロール」として設定しておいておく。
- いつ特権を付与したか監査ログから追跡できる。
#### Microsoft Entra PIM の設定方法
- PowerPlatformのAdminsに対してPIMを設定し、管理業務が発生したときに都度申請承認プロセスを経るように設定する例
- 詳細の設定方法は割愛
#### PowerPlatform管理者ロールをリクエストする
- 管理者側が特権が必要になっときに申請する例
- 詳細は割愛
## 自社のファイアウォールの設定
 - 自社FWのせいで通信できないかもしれないので、MSが公開しているPowerPlatformのエンドポイント情報を参照して通信先やIP範囲を確認しましょう
### PowerPlatform系のIPアドレス範囲を取得する
- Azure CLIを用いる。詳細は割愛

# 第5章 テナントの活動状況を監視する
思わぬコスト増大やセキュリティリスクを減らすために監視体制を確立しましょう
## 5-1 CoE スターターキット
- Conter of Excellence
- MSが公開しているApps,Automateなどを組み合わせたテンプレート。
- MSが提唱するガバナンスのベストプラクティスが反映されている。
- 初めて導入するときはここから始めると運用管理に必要な情報を自動的に収集・可視化しながら具現化しやすくなる。
- 各環境の使用状況を一元的に把握できるアプリが提供される。
- 注意点としてこれはMSによって作られてるがオープンソースなので、サポートチームにリクエストできない。GitHubのイシュー(不具合報告)に起票するしかない。
### CoEスターターキットの構成

| コンポーネント      | 用途                            |
| ------------ | ----------------------------- |
| 資産管理         | リソースを一元管理・可視化                 |
| ガバナンス        | 組織全体で統制を保つためのフレームワーク          |
| 育成           | 学習リソースやトレーニングプログラム            |
| イノベーションバックログ | 新規アイデアや要望の蓄積、優先付け、計画          |
| 管理・運用計画      | 管理タスクの標準化                     |
| テーマ管理        | UIを統一するためのテーマ設定機能             |
| 投資対効果測定      | PP導入を定量的に評価 ROI,コスト削減,効率化を可視化 |


### CoEスターターキットの前提条件
1. 管理者用のライセンス(必須)
	- Dataverseを利用できるライセンスがPowerPlatform管理者の分だけ必要
2. 専用のPowerPlatform環境(推奨)
	- 把握しやすくするため＆管理者だけに情報を秘匿するため
3. サービスアカウント(推奨)
	- 定期実行フローを誰のアカウントで所有するか決める。
	- 専用のアカウントを作成して統括管理するアプローチがよく採用される
4. 組織のPowerAppsPremiumライセンス(任意)
	- ガバナンスのワークフロー用アプリを使うため。一般ユーザーにアプリを公開しないなら管理者だけで十分
5. ダッシュボード用のPower BI Pro・Premiumのライセンス(任意)
	- CoEスターターキットに含まれるPowerBIダッシュボードをユーザーに公開するには公開先の人数分Proが必要。データエクスポートはPremiumが必要。
### CoEスターターキットとPower Platform管理センターの違い
詳しくは本書を参照してください
- PowerPlatform管理センターはシンプル
- CoEスターターキットはより高度なガバナンス支援できるけど難しいし費用がかかる
- 土台はPowerPlatformで一部の複雑な要件にはCoEを使うケースもよくある
